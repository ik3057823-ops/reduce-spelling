<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spelling Task — reduce</title>
  <style>
    :root {
      --bg: #ffffff;
      --ink: #1f2937;
      --ink-dim: #6b7280;
      --ok: #16a34a;
      --bad: #dc2626;
      --soft: #f3f4f6;
      --soft-2: #e5e7eb;
      --brand: #2563eb;
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    html, body { margin:0; height:100%; background: var(--bg); color: var(--ink); font-family: system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial, sans-serif; }
    .wrap { max-width: 780px; margin: 0 auto; padding: 16px; }
    .card {
      background: #fff; border: 1px solid var(--soft-2); border-radius: var(--radius);
      padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,.04);
    }
    h1 { font-size: clamp(20px, 3vw, 28px); margin: 0 0 8px; }
    .sub { color: var(--ink-dim); margin: 0 0 18px; font-size: 14px; }

    .zones { display: grid; gap: 18px; }

    .row { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    .label { min-width: 90px; color: var(--ink-dim); font-size: 14px; }

    /* Responsive grids */
    .bank, .slots {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(42px, 1fr));
      gap: 10px; width: 100%;
      background: var(--soft);
      padding: 12px; border-radius: var(--radius);
      border: 1px dashed var(--soft-2);
    }

    button.tile {
      appearance: none; border: 1px solid var(--soft-2); background: #fff;
      border-radius: 12px; padding: 10px 0; font-size: 20px; font-weight: 700;
      cursor: grab; user-select: none; line-height: 1; width: 100%;
      box-shadow: 0 2px 6px rgba(0,0,0,.05);
      transition: transform .06s ease;
    }
    button.tile:active { transform: scale(.98); }
    button.tile:focus { outline: 2px solid var(--brand); outline-offset: 2px; }

    .slot {
      display: grid; place-items: center; height: 48px; border-radius: 12px;
      border: 2px dashed var(--soft-2); background: #fff; font-weight: 700;
    }
    .slot.filled { border-style: solid; border-color: var(--soft-2); }
    .slot.ok { background: #ecfdf5; border-color: #86efac; }
    .slot.bad { background: #fef2f2; border-color: #fecaca; }

    .controls { display:flex; flex-wrap: wrap; gap: 10px; margin-top: 16px; }
    .btn {
      appearance:none; border:1px solid var(--soft-2); background:#fff; color:var(--ink);
      padding:10px 14px; border-radius: 12px; cursor:pointer; font-weight:600;
    }
    .btn.primary { background: var(--brand); color:#fff; border-color: var(--brand); }
    .btn.ghost { background: transparent; }
    .msg { margin-top: 14px; font-size: 14px; }
    .msg.ok { color: var(--ok); }
    .msg.bad { color: var(--bad); }

    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }

    /* Small screen adjustments */
    @media (max-width: 480px) {
      button.tile { font-size: 18px; padding: 8px 0; }
      .slots, .bank { gap: 6px; padding: 8px; }
      .controls { justify-content: flex-start; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="region" aria-labelledby="title">
      <h1 id="title">Build the word: <em>reduce</em></h1>
      <p class="sub">Click or drag letters into the slots in the correct order. Use <strong>Check</strong> to get feedback. Click a filled slot to return its letter to the bank.</p>

      <div class="zones" aria-live="polite">
        <div class="row" aria-label="Answer slots">
          <span class="label">Your answer</span>
          <div id="slots" class="slots"></div>
        </div>

        <div class="row" aria-label="Letter bank">
          <span class="label">Letter bank</span>
          <div id="bank" class="bank"></div>
        </div>
      </div>

      <div class="controls">
        <button class="btn primary" id="checkBtn">Check</button>
        <button class="btn" id="resetBtn">Reset</button>
        <button class="btn" id="shuffleBtn">Shuffle</button>
        <button class="btn ghost" id="hintBtn" title="Fill the next correct letter">Hint</button>
        <button class="btn ghost" id="sayBtn" title="Hear the word">🔈 Say it</button>
      </div>

      <div id="message" class="msg" role="status" aria-live="polite"></div>
      <p class="sr-only" id="live"></p>
    </div>
  </div>

  <script>
    const correctWord = "reduce";
    const letters = correctWord.split("").map((ch, i) => ({ id: ch + "-" + i, ch }));

    let bank = [];
    let slots = new Array(letters.length).fill(null);

    const $ = sel => document.querySelector(sel);
    function shuffle(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }
    function announce(text) { $("#live").textContent = text; }

    function render() {
      const bankEl = $("#bank");
      bankEl.innerHTML = "";
      bank.forEach(t => {
        const b = document.createElement("button");
        b.className = "tile";
        b.textContent = t.ch;
        b.draggable = true;
        b.setAttribute("aria-label", `Letter ${t.ch}`);
        b.dataset.id = t.id;
        b.addEventListener("click", () => {
          const idx = slots.findIndex(s => s === null);
          if (idx !== -1) moveTileToSlot(t.id, idx);
        });
        b.addEventListener("dragstart", e => {
          e.dataTransfer.setData("text/plain", JSON.stringify({ from: "bank", id: t.id }));
        });
        bankEl.appendChild(b);
      });

      const slotsEl = $("#slots");
      slotsEl.innerHTML = "";
      for (let i = 0; i < slots.length; i++) {
        const cell = document.createElement("div");
        cell.className = "slot" + (slots[i] ? " filled" : "");
        cell.setAttribute("role", "button");
        cell.setAttribute("aria-label", slots[i] ? `Slot ${i+1}: ${slots[i].ch}` : `Empty slot ${i+1}`);
        cell.tabIndex = 0;
        cell.addEventListener("dragover", e => e.preventDefault());
        cell.addEventListener("drop", e => {
          e.preventDefault();
          const data = JSON.parse(e.dataTransfer.getData("text/plain") || "{}");
          if (!data.id) return;
          if (!slots[i]) moveTileToSlot(data.id, i);
        });
        cell.addEventListener("click", () => { if (slots[i]) removeFromSlot(i); });
        cell.addEventListener("keydown", e => {
          if ((e.key === "Enter" || e.key === " ") && slots[i]) { e.preventDefault(); removeFromSlot(i); }
        });
        cell.textContent = slots[i] ? slots[i].ch : " ";
        slotsEl.appendChild(cell);
      }
    }

    function resetFeedback() {
      $("#message").className = "msg";
      [...document.querySelectorAll(".slot")].forEach(s => s.classList.remove("ok", "bad"));
    }

    function moveTileToSlot(tileId, slotIndex) {
      if (slots[slotIndex]) return;
      const i = bank.findIndex(t => t.id === tileId);
      if (i === -1) return;
      const [t] = bank.splice(i, 1);
      slots[slotIndex] = t;
      render();
      announce(`Placed ${t.ch} in slot ${slotIndex + 1}`);
    }

    function removeFromSlot(slotIndex) {
      const t = slots[slotIndex];
      if (!t) return;
      slots[slotIndex] = null;
      bank.push(t);
      render();
      announce(`Returned ${t.ch} from slot ${slotIndex + 1} to bank`);
    }

    function doCheck() {
      resetFeedback();
      if (slots.some(s => s === null)) {
        $("#message").textContent = "Fill all slots, then click Check.";
        $("#message").classList.add("bad");
        return;
      }
      const user = slots.map(s => s.ch).join("");
      const msg = $("#message");
      if (user === correctWord) {
        [...document.querySelectorAll("#slots .slot")].forEach(s => s.classList.add("ok"));
        msg.textContent = "Great job! ✅ That spells “reduce”.";
        msg.classList.add("ok");
      } else {
        [...document.querySelectorAll("#slots .slot")].forEach((s, i) => {
          const good = slots[i].ch === correctWord[i];
          s.classList.add(good ? "ok" : "bad");
        });
        msg.textContent = "Not quite. Incorrect letters are highlighted. Try again!";
        msg.classList.add("bad");
      }
    }

    function doHint() {
      resetFeedback();
      let idx = slots.findIndex(s => s === null);
      if (idx === -1) {
        idx = slots.findIndex((s, i) => !s || s.ch !== correctWord[i]);
        if (idx === -1) return;
        if (slots[idx]) removeFromSlot(idx);
      }
      const targetCh = correctWord[idx];
      const tile = bank.find(t => t.ch === targetCh);
      if (tile) {
        moveTileToSlot(tile.id, idx);
        $("#message").textContent = `Hint used: placed “${targetCh}” in slot ${idx + 1}.`;
      } else {
        $("#message").textContent = "No hint available right now.";
      }
    }

    function sayWord() {
      try {
        const u = new SpeechSynthesisUtterance("reduce");
        u.rate = 0.95; u.pitch = 1.0; u.lang = "en-US";
        speechSynthesis.speak(u);
      } catch (e) {}
    }

    function doReset(shuffleToo = false) {
      resetFeedback();
      bank = shuffleToo ? shuffle(letters) : letters.slice();
      slots = new Array(letters.length).fill(null);
      render();
      $("#message").textContent = shuffleToo ? "Shuffled letters." : "Reset.";
    }

    $("#checkBtn").addEventListener("click", doCheck);
    $("#resetBtn").addEventListener("click", () => doReset(false));
    $("#shuffleBtn").addEventListener("click", () => doReset(true));
    $("#hintBtn").addEventListener("click", doHint);
    $("#sayBtn").addEventListener("click", sayWord);

    doReset(true);
  </script>
</body>
</html>
